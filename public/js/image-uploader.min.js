/*! Image Uploader - v1.0.0 - 15/07/2019
 * Copyright (c) 2019 Christian Bayer; Licensed MIT */
!function(e){e.fn.imageUploader=function(t){let a={preloaded:[],imagesInputName:"images",preloadedInputName:"preloaded",label:"Drag & Drop files here or click to browse"},n=this;n.settings={},n.init=function(){n.settings=e.extend(n.settings,a,t),n.each((function(t,a){let i=d();if(e(a).append(i),i.on("dragover",o.bind(i)),i.on("dragleave",o.bind(i)),i.on("drop",p.bind(i)),n.settings.preloaded.length){i.addClass("has-files");let e=i.find(".uploaded");for(let t=0;t<n.settings.preloaded.length;t++)e.append(l(n.settings.preloaded[t].src,n.settings.preloaded[t].id,!0))}}))};let i=new DataTransfer,d=function(){let t=e("<div>",{class:"image-uploader"}),a=e("<input>",{type:"file",id:n.settings.imagesInputName,name:n.settings.imagesInputName+"[]",multiple:""}).appendTo(t),i=(e("<div>",{class:"uploaded"}).appendTo(t),e("<div>",{class:"upload-text"}).appendTo(t));e("<i>",{class:"material-icons",text:"cloud_upload"}).appendTo(i),e("<span>",{text:n.settings.label}).appendTo(i);return t.on("click",(function(e){s(e),a.trigger("click")})),a.on("click",(function(e){e.stopPropagation()})),a.on("change",p.bind(t)),t},s=function(e){e.preventDefault(),e.stopPropagation()},l=function(t,a){let d=e("<div>",{class:"uploaded-image"}),l=(e("<img>",{src:t}).appendTo(d),e("<button>",{class:"delete-image"}).appendTo(d));e("<i>",{class:"material-icons",text:"clear"}).appendTo(l);if(n.settings.preloaded.length){d.attr("data-preloaded",!0);e("<input>",{type:"hidden",name:n.settings.preloadedInputName+"[]",value:a}).appendTo(d)}else d.attr("data-index",a);return d.on("click",(function(e){s(e)})),l.on("click",(function(t){if(s(t),d.data("index")){let t=parseInt(d.data("index"));d.find(".uploaded-image[data-index]").each((function(a,n){a>t&&e(n).attr("data-index",a-1)})),i.items.remove(t)}d.remove(),d.find(".uploaded-image").length||d.removeClass("has-files")})),d},o=function(t){s(t),"dragover"===t.type?e(this).addClass("drag-over"):e(this).removeClass("drag-over")},p=function(t){s(t);let a=e(this);a.removeClass("drag-over");let n=t.target.files||t.originalEvent.dataTransfer.files;r(a,n)},r=function(t,a){t.addClass("has-files");let n=t.find(".uploaded"),d=t.find('input[type="file"]');e(a).each((function(e,t){i.items.add(t),n.append(l(URL.createObjectURL(t),i.items.length-1))})),d.prop("files",i.files)};return this.init(),this}}(jQuery);